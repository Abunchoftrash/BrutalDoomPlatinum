class NewIncineratorFlame : Actor // Incinerator Flame 
{
	Default
	{
		Damagefunction 10;
		Speed 40;
		Radius 13;
		Height 8;
		
		Projectile;
		+FORCERADIUSDMG;
		RenderStyle "Add";
		Damagetype "fire";
		//+rollsprite;
		Decal "FlamethrowerScorchNEO";
	}

	States
	{
	Spawn:
		TNT1 A 1 BRIGHT;
		TNT1 A 1
		{
			Double scalefactor = frandom(0.78,1.0);
			A_setscale(scalefactor,scalefactor);
		}
		FIR3 ABABCDEFGHIJKLMNOP 1 BRIGHT;
		Stop;
		
	Death:
		TNT1 A 0 A_Explode(10, 128, 1, 0, 1);
		FIR3 BCDEFGHIJKLMNOP 1 BRIGHT;
		Stop;
	}
	
	Override int SpecialMissileHit(Actor victim) 
		{
			If(victim && target && victim != target && !(victim is "baseheadshot"))
			{
				If(!Victim.findinventory("firetic"))
				{
					Victim.giveinventory("firetic",1);
				}
				Actor Flameactor = Victim.Findinventory("Firetic");
				If(Flameactor)
				{
					let flamer = Firetic(flameactor);
					if(flamer)
					{
						flamer.flamecauser = target;
						if(flamer.duration < 90)
						flamer.duration = 90;
						If(flamer.duration < 500)
						flamer.duration += 20;
					}
				
				}
				
			}
		
			Return -1;
		}
}

Class Firetic : Inventory {
	
	
	float duration; 
	actor flamecauser;
	Default {
		+INVENTORY.UNDROPPABLE
		+INVENTORY.UNTOSSABLE
		inventory.maxamount 1;
	}
	

	

	//Items that don't spawn in the world don't need their Tick. Emptying it will actually help performace:
	Override void Tick() {}
	
	//This function is executed every tic by items while they're in an actor's inventory:
	Override void DoEffect() {
		super.DoEffect();
		//console.printf("%i",duration);
		if (owner.isFrozen())
			return;
		if (level.time % 10 == 0) 
		{
			owner.damagemobj(flamecauser,flamecauser,7,"Fire");
			If(owner)
			owner.A_Explode(3, 200, XF_HURTSOURCE, 0, 1,DAMAGETYPE:"FIRE");
		}
		if (owner && owner.health <= 0) {		
			DepleteOrDestroy();
			return;
		}
		else if(owner)
		{
		
		
			int rad = owner.radius*0.5; //we'll use the monster's radius as a base value for horizontal offset randomization
			If (random(1,5) == 5)
			{
			
			
			owner.A_SpawnItemEx(
				"flametrailstic2",
							xofs:(frandom(-rad,rad)),
				yofs:(frandom(-rad,rad)),
				zofs:(frandom(0,owner.height)),xvel:frandom(-2,2),yvel:frandom(-2,2),zvel:frandom(0.5,3)
				);
			}
			Else
			{
				owner.A_SpawnItemEx(
				"flametrailstic",
							xofs:(frandom(-rad,rad)),
				yofs:(frandom(-rad,rad)),
				zofs:(frandom(0,owner.height)),xvel:frandom(-2,2),yvel:frandom(-2,2),zvel:frandom(0.5,3)
				);
			}
		}
		
			if (duration > 0)
				duration--;
			else {
				DepleteOrDestroy();
				return;
			}
		

		


		
	}
}
