CLASS BattleRifleAmmo : Ammo
{
	Default
	{
	Inventory.Amount 0;
	Inventory.MaxAmount 15;
	Ammo.BackpackAmount 0;
	Ammo.BackpackMaxAmount 15;
	Inventory.Icon "BR45L0";
	}
}

CLASS BattleRifle : Brutalweapon
{
	Default
	{
	Weapon.AmmoUse1 0;
	Weapon.AmmoUse2 0;
	Weapon.AmmoGive1 50;
	Weapon.AmmoGive2 0;
	Weapon.AmmoType1 "Clip2";
	Weapon.AmmoType2 "BattleRifleAmmo";
	Obituary "%o was pierced by %k's Battle Rifle.";
	Inventory.PickupSound "BR45PICK";
	Inventory.Pickupmessage "You got the Battle Rifle! (Slot 4)";
	+WEAPON.NOAUTOAIM;
	+WEAPON.NOALERT;
	+WEAPON.EXPLOSIVE;
	+FORCEXYBILLBOARD;
	scale 0.8;
	radius 24;
	height 24;
	damagetype "Revolver";
	Weapon.SelectionOrder 1550;
	Inventory.AltHUDIcon "BR45L0";
	BrutalWeapon.weight 2;
	}
	bool altzoom;
	bool burstselected;
	int burstcount;
	int savedzoom;
	bool scopezoom2;
	States
	{
	GrenadeThrowFlash:
		BR4S ABCDE 1;
		TNT1 A 22;
		BR4S EDCBA 1;//32 in total
		stop;

	FuckYouFlash:
		BK4K A 0 a_jumpif(countinv("battlerifleammo") < 1, "FuckYouFlashEmpty");
		BR4K ABCD 1;
		BR4K E 22;
		BR4K DCBA 1; //18
		stop;

	FuckYouFlashEmpty:
		BR4K FGHI 1;
		BR4K J 22;
		BR4K IHGF 1; //18
		stop;

	KickingFlash:
		BK4K F 0 a_jumpif(countinv("battlerifleammo") < 1, "KickingFlashEmpty");
		BR4K ABCD 1;
		BR4K E 10;
		BR4K DCBA 1;
		Goto Ready;

	KickingFlashEmpty:
		BR4K FGHI 1;
		BR4K J 10;
		BR4K IHGF 1;
		Goto Ready;

	AirKickingFlash:
		BK4K F 0 a_jumpif(countinv("battlerifleammo") < 1, "AirKickingFlashEmpty");
		BR4K ABCD 1;
		BR4K E 10;
		BR4K DCBA 1;
		Goto Ready;

	AirKickingFlashEmpty:
		BR4K FGHI 1;
		BR4K J 10;
		BR4K IHGF 1;
		Goto Ready;
	
	SlideKickingStart:
		BR4K F 0 a_jumpif(countinv("battlerifleammo") < 1, "SlideKickingStartEmpty");
		BR4K ABCD 1;
		BR4K EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE 1 { //39 total
			if (CountInv("Kicking") == 0) {
				return resolvestate("SlideKickingEnd");
			}
			return resolvestate(null);
		}
		Goto Ready;

	SlideKickingEnd:
		BR4K F 0 a_jumpif(countinv("battlerifleammo") < 1, "SlideKickingEndEmpty");
		BR4K E 6;
		BR4K DCBA 1; //10
		Goto Ready;

	SlideKickingStartEmpty:
		BR4K FGHI 1;
		BR4K JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ 1 { //39 total
			if (CountInv("Kicking") == 0) {
				return resolvestate("SlideKickingEnd");
			}
			return resolvestate(null);
		}
		Goto Ready;

	SlideKickingEndEmpty:
		BR4K J 6;
		BR4K IHGF 1; //10
		Goto Ready;
			
	SprintOverlay:
		BK4K F 0 a_jumpif(countinv("battlerifleammo") < 1, "SprintOverlayEmpty");
		BR4K ABCD 1;
	KeepSprinting:
		BK4K F 0 a_jumpif(countinv("battlerifleammo") < 1, "KeepSprintingEmpty");
		BR4K E 1 A_weaponreadyDX(WRF_ALLOWRELOAD,FALSE,FALSE);
		"####" A 0 A_keepsprinting();
		Goto ReturnFromSprint;

	ReturnfromSprint:
		BK4K F 0 a_jumpif(countinv("battlerifleammo") < 1, "ReturnfromSprintEmpty");
		BR4K DCBA 1 A_weaponreadyDX(WRF_ALLOWRELOAD,FALSE,FALSE);
		Goto ready;

	SprintOverlayEmpty:
		BR4K FGHI 1;
	KeepSprintingEmpty:
		BR4K J 1 A_weaponreadyDX(WRF_ALLOWRELOAD,FALSE,FALSE);
		"####" A 0 A_keepsprinting();
		Goto ReturnFromSprintEmpty;

	ReturnfromSprintEmpty:
		BR4K IHGF 1 A_weaponreadyDX(WRF_ALLOWRELOAD,FALSE,FALSE);
		Goto ready;

	Select:
		TNT1 A 0;
		NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RailgunCrosshair"));}else{A_SetCrosshair(0);}}
		Goto SelectFirstPersonLegs;
	SelectContinue: "####" A 0 A_GiveInventory("IsPlayingDoxMod",1); 
		UNHG A 0 A_takeinventory("disabletilting",1);
		TNT1 AAAAAAAAAAAAAA 0 A_Raise();
		TNT1 A 1 A_Raise();
		//TNT1 A 0 A_Giveinventory("RailgunSelected",1);
		RIFL C 0 A_GunSlingerReload("battlerifleammo",15,"clip2",1);
	ReturnFromNothing:
		TNT1 A 0 A_startSound("BR45PICK",1);
		TNT1 AAA 0;
		Goto SelectAnimation;

	SelectAnimation:
		NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RailgunCrosshair"));}else{A_SetCrosshair(0);}}
		BR4S A 0 a_jumpif(countinv("battlerifleammo") < 1, "SelectAnimationEmpty");
		BR4S EDCBA 1 A_WeaponReady(WRF_NOFIRE);
		Goto Ready;

	SelectAnimationEmpty:
		BR4S JIHGF 1 A_WeaponReady(WRF_NOFIRE);
		Goto Ready;

	Deselect: 
		"####" A 0 A_TakeInventory("IsPlayingDoxMod",1);
		"####" A 0 A_ClearOverlays(-2,-2);
		BR4S F 0 a_jumpif(countinv("battlerifleammo") < 1, "DeselectEmpty");
		BR4S ABCDE 1;
		TNT1 A 0 A_StopSOund(1);
		TNT1 A 0 A_StopSOund(2);
		TNT1 A 0 A_StopSOund(6);
		TNT1 A 0 A_TakeInventory("TossGrenade", 1);
		TNT1 AAAAAAAAAAAAAAAA 0 A_lower();
		TNT1 A 1 A_Lower();
		Wait;

	DeselectEmpty:
		BR4S FGHIJ 1;
		TNT1 A 0 A_StopSOund(1);
		TNT1 A 0 A_StopSOund(2);
		TNT1 A 0 A_StopSOund(6);
		TNT1 A 0 A_TakeInventory("TossGrenade", 1);
		TNT1 AAAAAAAAAAAAAAAA 0 A_lower();
		TNT1 A 1 A_Lower();
		Wait;

	Ready:
		BR45 K 0 a_jumpif(countinv("battlerifleammo") < 1, 2);
		BR45 A 0;
		BR45 "#" 1
		{
			A_weaponreadyDX(WRF_ALLOWRELOAD);
			invoker.burstcount = 0;
		}
		LOOP;

	Fidget:
		TNT1 A 0 A_overlay(-5,"pumpinghandlol");
		RAIL FGHI 1;
		RAIL JKLMNYYOO 1 A_WeaponReadyDX();
		TNT1 A 0 A_overlay(-5,"pumpinghandlol2");
		RAIL OOOO 1 A_WeaponReadyDX();
		TNT1 A 0 A_StartSound("RAILMAG2", 5);
		RAIL PR 1 A_WeaponReadyDX();
		RAIL TWWVUUUUUUUUU/*UUUUUUUUUU*/ 1 A_WeaponReadyDX();
		TNT1 A 0 A_StartSound("RAILINSR", 5);
		RAIL UUUUUTTSRQP 1 A_WeaponReadyDX();
		TNT1 A 0 A_overlay(-5,"pumpinghandlol2reverse");
		RAIL OOOOONMLKJ 1 A_WeaponReadyDX();
		TNT1 A 0 A_overlay(-5,"pumpinghandlolreverse");
		RAIL IHGF 1 A_WeaponReadyDX();
		Goto ready;

	Fire:
		TNT1 A 0 A_CheckIfAmmo("battlerifleammo");
		TNT1 A 0 A_semiflag();
		BR45 B 1 
		{
			A_overlay(-5,"DoNothing");
			A_zoomfactor(0.7);
			A_fireprojectile("shotgunparticles2",random(12,-12),false,0,0,0,random(9,-9));
			If(invoker.burstselected)
			{
				A_FireBullets (0, 0, -1, 90, "BR45BulletPuff", FBF_NORANDOM,8192,"decorativetracer",-12);
			}
			Else
			{
				A_FireBullets (0, 0, -1, 45, "BR45BulletPuff", FBF_NORANDOM,8192,"decorativetracer",-12);
			}
			A_startsound("BR45FIRE",1);
			A_GunLight();
			A_ALertMonstersDX();
			A_takeammo("battlerifleammo",1);
			invoker.burstcount++;
		}
		TNT1 A 0 
		{
				A_zoomfactor(1.0);
				A_fireprojectile("riflecasespawnversion2",5,false,0,-14,0);
			If(countinv("battlerifleammo") < 1)
			{
				A_fireprojectile("RifleClipSpawn",5,false,0,-14,0);
			}
		}
		TNT1 A 0 A_jumpif(invoker.burstselected && invoker.burstcount < 3,"burstfirerecoil");
		BR45 CD 1;
		BR45 D 1 A_jumpif(countinv("battlerifleammo") < 1,"LastFireRecoil");
		BR45 EFG 1
		{ 
			invoker.burstcount = 0; 
		}
		TNT1 A 0 A_Semirefire("Fire","SemiAutoLul");
		TNT1 A 0 A_CheckIfAmmo("BattleRifleAmmo",1,"reload");
		Goto Ready;

	LastFireRecoil:
		BR45 HIJ 1;
		Goto NoAmmo2;

	BurstFireRecoil:
		BR45 DEG 1;
		Goto Fire;

	SemiAutoLul:
		BR45 A 1;
		TNT1 A 0 A_Semirefire("Fire","SemiAutoLul");
		Goto Ready;

	Reload:
		BR45 K 0
		{
			invoker.semiautofired = false;
		}
		TNT1 A 0 A_takeinventory("reloading",1);
		TNT1 A 0 A_CheckIfAmmo("clip2",1,"noammo");
		TNT1 A 0 A_jumpifinventory("battlerifleammo",15,"ready");
		TNT1 A 0 A_startsound("BR45OPEN",3);
		BR4R ABCDEFGH 1;
		TNT1 A 0
		{
		If(countinv("battlerifleammo") > 0)
			{
				A_fireprojectile("RifleClipSpawn",5,false,0,-14,0);
			}
		}
		BR4R I 1;
		BR4R J 6;
		BR4R KLMNOPQ 1;
		BR4R R 1
		{
			A_startsound("BR45LOAD",3);
			A_reload("battlerifleammo", 15, "clip2");
		}
		BR4R STUVWXYZ 1;
		Goto Ready;

	NoAmmo:
		TNT1 A 0 
		{
			A_StartSound("weapons/empty", 3);
			invoker.burstcount = 0;
		}
	NoAmmo2:
		BR45 K 1;
		PISZ A 0 A_SemiRefire("NoAmmo2","NoAmmo2");
		TNT1 A 0 
		{
			if(GetCvar("bd_NoAutoReload") == 0)
			{
				if(countinv("battlerifleammo") < 1 && countinv("clip2") > 0)
				{
				Return resolvestate("reload");
				}
				else
				{
				Return resolvestate(null);
				}
			}
			else
			{
			Return resolvestate("ready");
			}
		}
		TNT1 A 0 A_CheckIfAmmo("clip2",1,"reload");
		Goto reload;
			
	AltFire:
	//	RLNG A 0 ACS_NamedExecuteAlways("HoldAim");
		//RLNG A 0 A_JumpIfInventory("Zoomed",1,"NoAim");
		//RLNG A 0 A_Giveinventory("Zoomed",1)
        
		
		RLNG A 0 
		{
			A_overlay(-5,"DoNothing");
			A_ZoomFactor(3.0);
			A_SetCrosshair(41);
			invoker.altzoom = false;
		}
		BR4Z ABCDE 1;
		SMGG A 0 A_StartSound("ADSIN");
	AltFireContinue:
		
		StillAiming:
		//TNT1 A 0 A_jumpifinventory("firedsecondary",1,"Aim1");
		TNT1 A 0 A_WeaponZoom();
		Goto Aim2;
		Aim1:
			TNT1 A 0;
			SMGG A 0 
			{
				A_ZoomFactor(3.0);
				If(countinv("swapriflespecial") > 0)
				{
					Takeinventory("swapriflespecial",1);
					
					If(invoker.scopezoom2)
					{
						invoker.scopezoom2 = false;
						A_StartSound("ADSOUT");
					}
					Else
					{
						invoker.scopezoom2 = true;
						A_StartSound("ADSIN");
					}
				}
				If(invoker.scopezoom2)
				{
					a_zoomfactor(9.0);
				}
				Else
				{
					A_ZoomFactor(3.0);
				}
			}
			BR4Z F 1 BRIGHT A_weaponready(WRF_NOSECONDARY | WRF_NOPRIMARY);
			TNT1 A 0 A_jumpifinventory("reloading",1,"Noammozoomed2");
			TNT1 A 0 A_jumpifinventory("firedprimary",1,"ZoomedFire");
			TNT1 A 0 A_jumpifinventory("firedsecondary",1,"Aim1");
			Goto noaim;
	Aim2:
		TNT1 A 0 
		{
		/*
			If(countinv("startdualwield") > 0)
			{
				Takeinventory("startdualwield",1);
	
			If(countinv("raillightscope") > 0)
				{
					A_takeinventory("raillightscope",1);
					a_startsound("bepbep",2);
				}
				Else
				{
					A_giveinventory("raillightscope",1);
					a_startsound("bep",2);
				}
			}
			If(countinv("raillightscope") > 0)
			{
				A_giveinventory("powerlightampc",1);
			}
			Else
			{
				A_takeinventory("powerlightampc",1);
			}
			*/

		}
		TNT1 A 0 A_jumpif(invoker.altzoom,"Aim3");
		//SMGG A 0 A_ZoomFactor(3.0);
		BR4Z F 1 BRIGHT A_weaponready(WRF_NOSECONDARY | WRF_NOPRIMARY);
		TNT1 A 0 A_jumpifinventory("reloading",1,"Noammozoomed2");
		TNT1 A 0 A_jumpifinventory("firedprimary",1,"ZoomedFire");
		TNT1 A 0 A_jumpifinventory("firedsecondary",1,"GoingToAim3");
		LOOP;

	GoingToAim3:
		TNT1 A 0 {invoker.altzoom = true;}
		TNT1 A 0 A_zoomfactor(9.0);
		TNT1 A 0 A_StartSound("ADSIN");
		BR4Z F 5 BRIGHT;
	Aim3:
		TNT1 A 0;
		SMGG A 0 A_ZoomFactor(9.0);
		BR4Z F 1 BRIGHT A_weaponready(WRF_NOSECONDARY | WRF_NOPRIMARY);
		TNT1 A 0 A_jumpifinventory("reloading",1,"Noammozoomed2");
		TNT1 A 0 A_jumpifinventory("firedprimary",1,"ZoomedFire");
		TNT1 A 0 A_jumpifinventory("firedsecondary",1,"NoAim");
		LOOP;

	ZoomedFire:
		TNT1 A 0 A_CheckIfAmmo("BattleRifleAmmo",1,"NoAmmoZoomed");
		TNT1 A 0 A_semiflag();
		RAIL A 0 
		{
			A_overlay(-5,"DoNothing");
			invoker.savedzoom = invoker.owner.player.fov;
			//console.printf("%i",invoker.savedzoom);
				invoker.owner.player.fov = invoker.owner.player.fov * 0.7;
				A_fireprojectile("shotgunparticles2",random(12,-12),false,0,0,0,random(9,-9));
				If(invoker.burstselected)
				{
					A_FireBullets (0, 0, -1, 27, "BR45BulletPuff", FBF_NORANDOM,8192,"decorativetracer",-12);
				}
				Else
				{
					A_FireBullets (0, 0, -1, 40, "BR45BulletPuff", FBF_NORANDOM,8192,"decorativetracer",-12);
				}
				A_startsound("BR45FIRE",1);
				//A_setpitch(pitch - 1.5);
				A_GunLight();
				A_ALertMonstersDX();
				A_takeammo("battlerifleammo",1);
				invoker.burstcount++;
			}
		BR4Z F 1 BRIGHT // A_setpitch(pitch + 0.5);
		{
			invoker.owner.player.fov = invoker.savedzoom;
			A_fireprojectile("riflecasespawnversion2",5,false,15,-7,0);
			If(countinv("battlerifleammo") < 1)
			{
				A_fireprojectile("RifleClipSpawn",5,false,15,-7,0);
			}
		}
		BR4Z F 3 BRIGHT; //A_setpitch(pitch + 0.5);
		TNT1 A 0 A_jumpif(invoker.burstselected && invoker.burstcount < 3,"ZoomedFire");
		BR4Z F 3 BRIGHT
		{
			invoker.burstcount = 0;
		}
		TNT1 A 0 A_Semirefire("ZoomedFire","SemiAutoLulZoomed");
		TNT1 A 0 A_WeaponZoom2();
		TNT1 A 0 A_CheckIfAmmo("BattleRifleAmmo",1,"NoAmmoZoomed2");
		Goto StillAiming;

	SemiAutoLulZoomed:
		BR4Z F 1 BRIGHT;
		TNT1 A 0 A_Semirefire("ZoomedFire","SemiAutoLulZoomed");
		TNT1 A 0 A_WeaponZoom2();
		TNT1 A 0 A_CheckIfAmmo("BattleRifleAmmo",1,"NoAmmoZoomed2");
		Goto StillAiming;

		/*
		RLNG A 0 A_Light0();
		RLNG A 0 A_Takeinventory("PowerLightAmp", 1);
		RLNG A 0 A_Takeinventory("PowerLightAmpc", 1);
		RLNG A 0 A_ZoomFactor(1.0);
		//NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RLCrosshair"));}else{A_SetCrosshair(0);}}
		SMGG A 0 A_StartSound("ADSOUT");
		RAIZ FE 1;
		NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RailgunCrosshair"));}else{A_SetCrosshair(0);}}
		RAIZ DCBA 1;
		Goto Pumping;
		*/
	NoAmmoZoomed:
		TNT1 A 0
		{
			invoker.burstcount = 0;
			A_startsound("weapons/empty",4);
		}
		BR4Z F 1 BRIGHT;
		PISZ A 0 A_SemiRefire("NoAmmoZoomed","NoAmmoZoomed");
		TNT1 A 0
		{
			if(GetCvar("bd_NoAutoReload") == 0)
			{
				if(countinv("battlerifleammo") < 1 && countinv("clip2") > 0)
				{
				Return resolvestate("NoAmmoZoomed2");
				}
				else
				{
				Return resolvestate(null);
				}
			}
			else
			{
			Return resolvestate("StillAiming");
			}
		}
		TNT1 A 0 A_WeaponZoom2();
		TNT1 A 0 A_CheckIfAmmo("clip2",1,"NoAmmoZoomed2");
		Goto NoAmmoZoomed2;

	NoAmmoZoomed2:
		RLNG A 0 A_Light0();
		RLNG A 0 A_Takeinventory("PowerLightAmp", 1);
		RLNG A 0 A_Takeinventory("PowerLightAmpc", 1);
		RLNG A 0 A_ZoomFactor(1.0);
		// NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RLCrosshair"));}else{A_SetCrosshair(0);}}
		SMGG A 0 A_StartSound("ADSOUT");
		NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RailgunCrosshair"));}else{A_SetCrosshair(0);}}
		BR4Z EDCBA 1;
		Goto Reload;

	NoAim:
		RLNG A 0 A_Light0();
		RLNG A 0 A_Takeinventory("swapriflespecial", 1);
		TNT1 A 0 A_takeinventory("startdualwield",1);
		RLNG A 0 A_Takeinventory("PowerLightAmpc", 1);
		RLNG A 0 A_ZoomFactor(1.0);
	   // NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RLCrosshair"));}else{A_SetCrosshair(0);}}
		SMGG A 0 A_StartSound("ADSOUT");
		NULL A 0{if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("RailgunCrosshair"));}else{A_SetCrosshair(0);}}
		BR4Z EDCBA 1;
		Goto Ready;

		DualWield:
			TNT1 A 0 A_takeinventory("startdualwield",1);
			BR45 K 0 a_jumpif(countinv("battlerifleammo") < 1,2);
			BR45 A 0;
			BR45 "#" 1 A_weaponoffset(0,33);
			BR45 "#" 1
			{
				A_weaponoffset(0,34);
				
				A_startsound("dryfire",2);
				If(invoker.burstselected)
				{
					invoker.burstselected = false;
					A_Print("Semi Auto");
				}
				Else
				{
					invoker.burstselected = true;
					A_Print("Burst Fire");
				}
			}
			BR45 "#" 1 A_weaponoffset(0,33);
			BR45 "#" 1 A_weaponoffset(0,WEAPONTOP, WOF_INTERPOLATE);
			TNT1 A 0 A_takeinventory("startdualwield",1);
			Goto Ready;
			
		Spawn:
			BR45 L -1;
			LOOP;

		Unload:
			RAIL A 1 A_WeaponReady();
			RAIL A 0 A_ZoomFactor(1.0);
			RAIL A 0 A_Takeinventory("Unloading",1);
			RAIL A 0 A_Takeinventory("ADSmode",1);
			RAIL A 0 A_Takeinventory("Zoomed",1);
			RAIL A 0 A_JumpIfInventory("NuRailgunAmmo",1,1);
			Goto Ready;
		RemoveBullets:
			TNT1 A 0 A_overlay(-5,"pumpinghandlol");
			RAIL FGHI 1;
			
			RAIL JKLMNYYOO 1;
			TNT1 A 0 A_overlay(-5,"pumpinghandlol2");
			RAIL OOOO 1;
			RAIL A 0 A_JumpIfInventory("NuRailgunAmmo",1,1);
			Goto FinishUnload;
			TNT1 A 0 A_StartSound("RAILMAG2", 5);
			RAIL PR 1;
			RAIL TWWV 1;
			RAIL A 0 A_Takeinventory("NuRailgunAmmo",1);
			RAIL A 0 A_Giveinventory("AmmoCell",10);
			RAIL UUUUUUUUU/*UUUUUUUUUU*/ 1;
			TNT1 A 0 A_StartSound("RAILINSR", 5);
			RAIL UUUUUTTSRQP 1;
			Goto RemoveBullets+19;
		FinishUnload:
			TNT1 A 0 A_overlay(-5,"pumpinghandlol2reverse");
			RAIL OOOOONMLKJ 1;
			TNT1 A 0 A_overlay(-5,"pumpinghandlolreverse");
			RAIL IHGF 1;
			Goto Ready;
	}
	
}